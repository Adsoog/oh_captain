{% load widget_tweaks %}

<div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">

  <!-- ***** Columna Izquierda: Formulario de solicitud de viáticos ***** -->
  <div class="bg-white shadow-md rounded-lg p-4">
    <form method="POST" action="">
      {% csrf_token %}
      <table class="w-full table-auto">
        <tbody>

          <!-- Fecha de Inicio -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 w-1/4 font-bold">Fecha de Inicio</td>
            <td class="py-2 px-2">
              {{ form.start_date|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Fecha de Fin -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Fecha de Fin</td>
            <td class="py-2 px-2">
              {{ form.end_date|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Cantidad de Días -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Días</td>
            <td class="py-2 px-2">
              {{ form.days|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Vehículos Asignados -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Vehículos</td>
            <td class="py-2 px-2">
              {{ form.vehicles|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Personas Asignadas -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Personas</td>
            <td class="py-2 px-2">
              {{ form.persons|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Detalles de la Solicitud -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Detalles</td>
            <td class="py-2 px-2">
              {{ form.details|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Total de Gastos -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Total Estimado</td>
            <td class="py-2 px-2">
              {{ form.total_expense|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

        </tbody>
      </table>

      <!-- Botón de Guardar -->
      <div class="flex justify-end mt-4">
        <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition">
          Guardar Solicitud
        </button>
      </div>
    </form>
  </div>

  <!-- ***** Columna Derecha: Items de Viáticos ***** -->
  {% if perdiem_request %}
  <div class="bg-white shadow-md rounded-lg p-4">
    <h3 class="text-lg font-semibold mb-4">Gastos de Viáticos</h3>

    <form method="POST" action="">
      {% csrf_token %}
      <table class="w-full table-auto">
        <tbody>

          <!-- Tipo de Gasto -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 w-1/4 font-bold">Tipo de Gasto</td>
            <td class="py-2 px-2">
              {{ perdiem_item_form.item|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Precio Unitario -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Precio Unitario</td>
            <td class="py-2 px-2">
              {{ perdiem_item_form.price|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Cantidad -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Cantidad</td>
            <td class="py-2 px-2">
              {{ perdiem_item_form.amount|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Moneda -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Moneda</td>
            <td class="py-2 px-2">
              {{ perdiem_item_form.currency|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Descripción -->
          <tr class="border-b border-gray-200">
            <td class="py-2 px-2 font-bold">Descripción</td>
            <td class="py-2 px-2">
              {{ perdiem_item_form.description|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

        </tbody>
      </table>

      <!-- Botón de Agregar Gasto -->
      <div class="flex justify-end mt-4">
        <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition">
          Agregar Gasto
        </button>
      </div>
    </form>

    <!-- Lista de Gastos Agregados -->
    {% if perdiem_request.perdiem_request_item.all %}
    <div class="mt-4">
      <h4 class="text-md font-semibold mb-2">Gastos Agregados</h4>
      <ul class="list-disc pl-4">
        {% for item in perdiem_request.perdiem_request_item.all %}
        <li class="border-b py-2 flex justify-between">
          <span>{{ item.item }} - {{ item.amount }} x {{ item.price }} {{ item.currency }}</span>
          <a href="" class="text-red-500 hover:text-red-700">Eliminar</a>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
  {% endif %}
</div>