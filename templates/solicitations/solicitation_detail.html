{% extends "base/base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Detalles de la Solicitud{% endblock %}
{% block page_title %}Detalles de la Solicitud{% endblock %}

{% block content %}
<!-- Contenedor grid: 2 columnas en pantallas md+ -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">

  <!-- ***** Columna Izquierda: “un solo panel” con 2 formularios ***** -->
  <div class="bg-white shadow-md rounded-lg p-3">

    <!-- Formulario 1: Cambiar Tipo (primera fila de la tabla) -->
    <form method="POST"
          hx-post="{% url 'solicitation_type_form' solicitation.pk %}"
          hx-target="body"
          hx-swap='outerHTML'
          hx-trigger='change'>
      {% csrf_token %}
      <table class="w-full table-auto">
        <tbody>
          <!-- Fila para seleccionar el tipo de Solicitud -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2 w-1/4 font-bold">
              Tipo de Solicitud
            </td>
            <td class="py-1 px-2">
              {% render_field type_form.solicitation_type class="w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" %}
            </td>
          </tr>
        </tbody>
      </table>
    </form>
    {% if solicitation.solicitation_type %}
    <!-- Formulario 2: Resto de la Solicitud (mismas clases de “tabla cliente”) -->
    <form method="POST" action="{% url 'solicitation_edit' solicitation.pk %}">
      {% csrf_token %}
      <table class="w-full table-auto">
        <tbody>
          <!-- Fecha de Solicitud -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2 w-1/4">
              <strong>Fecha de Solicitud:</strong>
            </td>
            <td class="py-1 px-2">
              {{ form.requested_at|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Razón -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2">
              <strong>Razón:</strong>
            </td>
            <td class="py-1 px-2">
              {{ form.reason|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Empleado -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2">
              <strong>Empleado:</strong>
            </td>
            <td class="py-1 px-2">
              {{ form.employee|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Área -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2">
              <strong>Área:</strong>
            </td>
            <td class="py-1 px-2">
              {{ form.area|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Departamento -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2">
              <strong>Departamento:</strong>
            </td>
            <td class="py-1 px-2">
              {{ form.department|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Orden de Trabajo -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2">
              <strong>Orden de Trabajo:</strong>
            </td>
            <td class="py-1 px-2">
              {{ form.work_order|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>

          <!-- Cliente -->
          <tr class="border-b border-gray-200">
            <td class="py-1 px-2">
              <strong>Cliente:</strong>
            </td>
            <td class="py-1 px-2">
              {{ form.client|add_class:"w-full px-4 py-2 border rounded-md focus:ring-blue-500 focus:border-blue-500" }}
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Botón del segundo formulario -->
      <div class="flex justify-end mt-4">
        <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 transition">
          Guardar cambios
        </button>
      </div>
    </form>
    {% else %}
    <!-- Aquí un mensaje o lo que prefieras mostrar cuando
    no hay tipo de solicitud seleccionado -->
    <p class="text-gray-700">Para ver los campos de solicitud, primero seleccione el tipo de Solicitud.</p>
    {% endif %}

  </div>  <!-- Fin Columna Izquierda -->

  <!-- ***** Columna Derecha: partial con detalles adicionales ***** -->
{% if solicitation.solicitation_type %}
  <div class="bg-white shadow-md rounded-lg p-6">
    {% with partial_template="solicitations/partials/_detail_"|add:solicitation.solicitation_type|add:".html" %}
      {% include partial_template %}
    {% endwith %}
  </div>
{% else %}
  <!-- Opcional: Muestra un aviso o deja un espacio en blanco -->
  <div class="bg-white shadow-md rounded-lg p-6 mt-4">
    <p class="text-gray-700">No hay detalles adicionales porque aún no se ha seleccionado el tipo de Solicitud.</p>
  </div>
{% endif %}


</div>
{% endblock content %}
